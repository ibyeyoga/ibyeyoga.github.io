<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[关于百度Ueditor的一个BUG]]></title>
      <url>/2018/03/16/%E4%BF%AE%E5%A4%8Dueditor%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%97%B6%E5%87%BA%E7%8E%B0%E7%9A%84BUG/</url>
      <content type="html"><![CDATA[<h1 id="关于百度Ueditor的一个BUG"><a href="#关于百度Ueditor的一个BUG" class="headerlink" title="关于百度Ueditor的一个BUG"></a>关于百度Ueditor的一个BUG</h1><blockquote>
<p>遭遇：百度UE是我目前所在的公司一直都有使用的产品，最近我个人在本机调试的时候发现上传图片发生了异常，但是在服务器上已经存储了该图片，只是UE一直提示上传错误，并且没有将上传成功的图片自动放到编辑内容中去。<br>如图：<br><img src="http://oivwa6p90.bkt.clouddn.com/MD_1519283700" alt="img"></p>
</blockquote>
<h6 id="排查了一些时间之后，发现原因出自下面这句代码："><a href="#排查了一些时间之后，发现原因出自下面这句代码：" class="headerlink" title="排查了一些时间之后，发现原因出自下面这句代码："></a>排查了一些时间之后，发现原因出自下面这句代码：</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result = body.innerText || body.textContent || &quot;&quot;;</div></pre></td></tr></table></figure>
<p><strong><em>详细位置在 ueditor.all.js 第24523行 (源码中是在_src\plugins\simpleupload.js第103行) </em></strong></p>
<blockquote>
<p>当浏览器装有某些插件的时候，会导致这种方式可能获取的json字符串不是标准的json字符串,例如Json Viewer Awesome，会将页面输出是标准json的字符串进行渲染，会在页面中添加自己的代码。</p>
</blockquote>
<p><em>例如一段标准json字符串（在没有装任何json插件的浏览器中）输出如下：</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">如下：</div><div class="line">&#123;</div><div class="line">&quot;state&quot;: &quot;SUCCESS&quot;,</div><div class="line">&quot;url&quot;: &quot;/static/uploads/ue/image/20180222/1519283606115669.jpg&quot;,</div><div class="line">&quot;title&quot;: &quot;1519283606115669.jpg&quot;,</div><div class="line">&quot;original&quot;: &quot;下载.jpg&quot;,</div><div class="line">&quot;type&quot;: &quot;.jpg&quot;,</div><div class="line">&quot;size&quot;: 32920</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>但在装有Json Viewer Awesome插件时，输出如下：</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">如下：</div><div class="line">Tree</div><div class="line">Chart</div><div class="line">JSON Input</div><div class="line">&#123;</div><div class="line">&quot;state&quot;: &quot;SUCCESS&quot;,</div><div class="line">&quot;url&quot;: &quot;/static/uploads/ue/image/20180222/1519283606115669.jpg&quot;,</div><div class="line">&quot;title&quot;: &quot;1519283606115669.jpg&quot;,</div><div class="line">&quot;original&quot;: &quot;下载.jpg&quot;,</div><div class="line">&quot;type&quot;: &quot;.jpg&quot;,</div><div class="line">&quot;size&quot;: 32920</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>看到前三行结果就一目了然了</p>
</blockquote>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><blockquote>
<p>截取json部分，考虑到其他插件也可能会导致相同的BUG，所以用正则表达式捕获。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//在第24523行(源码中是在_src\plugins\simpleupload.js第103行)下面，添加</div><div class="line">var jsonMatchPattern = /\&#123;(.+?)\&#125;/;</div><div class="line">var jsonMatch = result.replace(/[\r\n]/g,&quot;&quot;).match(jsonMatchPattern);</div><div class="line">result = jsonMatch[0];</div></pre></td></tr></table></figure></p>
</blockquote>
<p>或者到这里下载修改版源码，自己打包：<br><a href="https://github.com/ibyeyoga/ueditor" target="_blank" rel="external">https://github.com/ibyeyoga/ueditor</a></p>
]]></content>
      
        <categories>
            
            <category> 前端 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 疑难杂症 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[webpack简单使用]]></title>
      <url>/2018/02/26/webpack%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ol>
<li>安装node.js 传送门：<a href="https://nodejs.org/en/" target="_blank" rel="external">https://nodejs.org/en/</a></li>
<li>进入你的项目根目录，然后安装webpack-cli：npm install webpack-cli -D</li>
<li>安装webpack：npm install webpack</li>
</ol>
<h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><ol>
<li>在项目根目录新建文件 webpack.config.js；</li>
<li>加入如下代码：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">let path = require(&apos;path&apos;);//引入path库</div><div class="line">module.exports = &#123;</div><div class="line">    entry : &apos;./src/main.js&apos;,//需要被打包的入口文件</div><div class="line">    output: &#123;</div><div class="line">        filename: &quot;bundle.js&quot;,//目标文件名</div><div class="line">        path: path.resolve(&apos;./dist&apos;)//获取目标文件的路径</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>3.修改package.json 中的 scripts 项，添加 <code>&quot;pk&quot;:&quot;webpack&quot;</code> ：</p>
<p> 4.命令行中执行npm run pk</p>
<h3 id="多入口打包"><a href="#多入口打包" class="headerlink" title="多入口打包"></a>多入口打包</h3><ol>
<li>同上</li>
<li><p>加入如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">let path = require(&apos;path&apos;);</div><div class="line">module.exports = &#123;</div><div class="line">    entry : &#123;</div><div class="line">        main:&apos;./src/main.js&apos;,</div><div class="line">        main1:&apos;./src/main1.js&apos;</div><div class="line">    &#125;,</div><div class="line">    output: &#123;</div><div class="line">        filename: &quot;[name].js&quot;,</div><div class="line">        path: path.resolve(&apos;./dist&apos;)</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>同上</p>
</li>
<li>同上</li>
</ol>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[使用文件锁解决并发问题]]></title>
      <url>/2018/01/12/%E4%BD%BF%E7%94%A8%E6%96%87%E4%BB%B6%E9%94%81%E8%A7%A3%E5%86%B3%E5%B0%8F%E8%A7%84%E6%A8%A1%E7%9A%84%E5%B9%B6%E5%8F%91%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>PHP使用文件锁非常简单，通过文件锁可以快速地设计一些并发量不大的临时功能。不过文件锁的缺点非常致命，所以如果有条件的话最好还是用上MQ。</p>
</blockquote>
<hr>
<blockquote>
<p>关键函数原型 <code>bool flock ( resource $handle , int $operation [, int &amp;$wouldblock ] )</code><br>这里解释一下第二个参数</p>
<ul>
<li>LOCK_SH 获取共享锁.</li>
<li>LOCK_EX 获取互斥锁.</li>
<li>LOCK_UN 释放锁.</li>
<li>官方文档还说：如果你不想代码块阻塞导致超时，可以加上LOCK_NB.</li>
</ul>
<hr>
</blockquote>
<h3 id="同步锁"><a href="#同步锁" class="headerlink" title="同步锁"></a>同步锁</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$fp = fopen(&quot;lockfile&quot;, &quot;r&quot;);</div><div class="line">if(flock($fp,LOCK_EX))</div><div class="line">&#123;</div><div class="line">//处理请求，会一直等待</div><div class="line">flock($fp,LOCK_UN);</div><div class="line">&#125;</div><div class="line">fclose($fp);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>
<h3 id="异步锁（伪）"><a href="#异步锁（伪）" class="headerlink" title="异步锁（伪）"></a>异步锁（伪）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$fp = fopen(&quot;lockfile&quot;, &quot;r&quot;);</div><div class="line">if(flock($fp,LOCK_EX | LOCK_NB))</div><div class="line">&#123;</div><div class="line">//处理请求</div><div class="line">flock($fp,LOCK_UN);</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">echo &quot;如果文件被锁，这里会即时返回信息&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">fclose($fp);</div><div class="line">?&gt;</div></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> PHP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 疑难杂症 </tag>
            
            <tag> PHP </tag>
            
            <tag> 并发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[数据迁移时出现errno:13]]></title>
      <url>/2017/07/15/%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%97%B6%E5%87%BA%E7%8E%B0errno-13/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　最近数据库损坏了，幸好有迁移文件，于是试着恢复数据库结构，结果出现下面图片所示的错误。</p>
<p><img src="http://oivwa6p90.bkt.clouddn.com/1500129432.png" width="558" height="179"></p>
<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>　　大概是之前装过一些杂七杂八的服务，因为都是一些第三方的自动安装脚本，可能在某些操作上将我mysql目录的owner改了。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p><code>sudo chown -R mysql /usr/local/mysql/data</code></p>
]]></content>
      
        <categories>
            
            <category> MySQL </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Lumen </tag>
            
            <tag> 疑难杂症 </tag>
            
            <tag> PHP </tag>
            
            <tag> MySQL </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Yii2高级模板URL美化]]></title>
      <url>/2017/05/14/Yii2%E9%AB%98%E7%BA%A7%E6%A8%A1%E6%9D%BFURL%E7%BE%8E%E5%8C%96/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　最近yoGa想做一个Yii2高级模板的URL美化，目标是：</p>
<p>　　1. 通过ibye.cn/admin/杂七杂八 访问 ibye.cn/backend/web/index.php/杂七杂八；<br>　　2. 通过ibye.cn/杂七杂八 访问 ibye.cn/frontend/web/index.php/杂七杂八。</p>
<h1 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h1><p>　　yoGa使用的服务器端软件是apache，下面是apache虚拟机的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//httpd-vhosts.conf:</div><div class="line">&lt;VirtualHost *:80&gt;</div><div class="line">    ServerAdmin yoga@ibye.cn</div><div class="line">    DocumentRoot &quot;/Users/yoga/Sites/yii2&quot;</div><div class="line">    ServerName ibye.cn</div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure>
<p>　　还需要修改一下HOSTS文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">127.0.0.1 ibye.cn</div></pre></td></tr></table></figure>
<p>​    <strong><em>注：因为修改了apache配置文件，需要重启一下apache服务。</em></strong></p>
<p>　　接下来是<code>.htaccess</code>文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">#这个放到/Users/yoga/Sites/yii2，即项目根目录</div><div class="line">&lt;IfModule mod_rewrite.c&gt;</div><div class="line">RewriteEngine on</div><div class="line">RewriteCond %&#123;REQUEST_URI&#125; ^/(admin)</div><div class="line">RewriteRule ^admin/assets/(.*)$ backend/web/assets/$1 [L]</div><div class="line">RewriteRule ^admin/css/(.*)$ backend/web/css/$1 [L]</div><div class="line">RewriteCond %&#123;REQUEST_URI&#125; !^/backend/web/(assets|css)/</div><div class="line">RewriteCond %&#123;REQUEST_URI&#125; ^/(admin)</div><div class="line">RewriteRule ^.*$ backend/web/index.php [L]</div><div class="line">RewriteCond %&#123;REQUEST_URI&#125; ^/(assets|css)</div><div class="line">RewriteRule ^assets/(.*)$ frontend/web/assets/$1 [L]</div><div class="line">RewriteRule ^css/(.*)$ frontend/web/css/$1 [L]</div><div class="line">RewriteCond %&#123;REQUEST_URI&#125; !^/(frontend|backend)/web/(assets|css)/</div><div class="line">RewriteCond %&#123;REQUEST_URI&#125; !index.php</div><div class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f [OR]</div><div class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</div><div class="line">RewriteRule ^.*$ frontend/web/index.php</div><div class="line">&lt;/IfModule&gt;</div><div class="line">#下面这个分别放到 根目录/frontend/web/ 和 根目录/backend/web/</div><div class="line">RewriteEngine on</div><div class="line">RewriteCond %&#123;SCRIPT_FILENAME&#125; !-f</div><div class="line">RewriteCond %&#123;SCRIPT_FILENAME&#125; !-d</div><div class="line">RewriteRule ^(.*)$ index.php/$1</div></pre></td></tr></table></figure>
<p>　　接着，需要新建一个<code>Request.php</code>文件，我把它放在了<code>根目录/common/components</code>下面，如果没有<code>components</code>这个文件夹可以新建一个。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">common</span>\<span class="title">components</span>;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> <span class="keyword">extends</span> \<span class="title">yii</span>\<span class="title">web</span>\<span class="title">Request</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> $web;</div><div class="line">    <span class="keyword">public</span> $adminUrl;</div><div class="line">  <span class="comment">/*</span></div><div class="line">   * 这里重写了\yii\web\Request的两个方法，目的是把URL某些不想给人看到的东西藏起来(*^__^*)</div><div class="line">   */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBaseUrl</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> str_replace(<span class="keyword">$this</span>-&gt;web, <span class="string">""</span>, <span class="keyword">parent</span>::getBaseUrl()) . <span class="keyword">$this</span>-&gt;adminUrl;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resolvePathInfo</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;getUrl() === <span class="keyword">$this</span>-&gt;adminUrl)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">""</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">parent</span>::resolvePathInfo();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>　　最后，修改main.php，分别是<code>frontend/config</code>和<code>backend/config</code>里面的main.php配置文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//找到key为'components'的地方，在里面的数组中 添加/修改</span></div><div class="line"><span class="string">'request'</span> =&gt; [</div><div class="line">            <span class="string">'csrfParam'</span> =&gt; <span class="string">'_csrf-backend'</span>,</div><div class="line">            <span class="string">'class'</span> =&gt; <span class="string">'common\components\Request'</span>,</div><div class="line">            <span class="string">'web'</span>=&gt; <span class="string">'/backend/web'</span>,<span class="comment">//若是frontend/config/main.php则改成/frontend/web</span></div><div class="line">            <span class="string">'adminUrl'</span> =&gt; <span class="string">'/admin'</span><span class="comment">//若是frontend/config/main.php则删掉</span></div><div class="line">        ],</div><div class="line"> <span class="string">'urlManager'</span> =&gt; [</div><div class="line">            <span class="string">'enablePrettyUrl'</span> =&gt; <span class="keyword">true</span>,</div><div class="line">            <span class="string">'showScriptName'</span> =&gt; <span class="keyword">false</span>,</div><div class="line">            <span class="string">'rules'</span> =&gt; [</div><div class="line">                <span class="string">'&lt;module:\w+&gt;/&lt;controller:\w+&gt;/&lt;action:\w+&gt;/&lt;id:\d+&gt;'</span> =&gt; <span class="string">'&lt;module&gt;/&lt;controller&gt;/&lt;action&gt;'</span>,</div><div class="line">                <span class="string">'&lt;controller:\w+&gt;/&lt;action:\w+&gt;/&lt;id:\d+&gt;'</span> =&gt; <span class="string">'&lt;controller&gt;/&lt;action&gt;'</span>,</div><div class="line">                <span class="string">'&lt;controller:\w+&gt;/&lt;action:\w+&gt;'</span> =&gt; <span class="string">'&lt;controller&gt;/&lt;action&gt;'</span></div><div class="line">            ],</div><div class="line">        ],</div></pre></td></tr></table></figure>
<p>　　ＯＫ接下来可以在浏览器的地址栏上写上帅气的URL了。</p>
]]></content>
      
        <categories>
            
            <category> PHP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Yii </tag>
            
            <tag> Yii2 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[使用ftp上传文件遇到553错误的解决方法]]></title>
      <url>/2017/05/11/%E4%BD%BF%E7%94%A8ftp%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E9%81%87%E5%88%B0553%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　最近重新配置了一下ftp服务器，发生了错误，当然这次错误是自己造成的。</p>
<p>　　废话不说了，上图：</p>
<p><img src="http://oivwa6p90.bkt.clouddn.com/1494514294.png" width="284" height="18"></p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>　　其实出现这个错误都是粗心大意造成的，例如我们的目录是/home/ibye.cn，我们新建了一个用户yoga(<code>useradd -d /home/ibye.cn</code>)，这时候我们是可以登录到/home/ibye.cn的，但是我们还没有给yoga这个用户对于/home/ibye.cn的权限，因为我们创建/home/ibye.cn目录时，可能是使用其他用户创建的，例如用root创建的话，该目录的owner就是root，而使用其他账号就可能不能在该目录上传文件。所以我们需要通过下面的命令将/home/ibye.cn的owner改为yoga。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chown -R yoga /home/ibye.cn</div></pre></td></tr></table></figure>
<p>注：如果出现读写权限问题，可能还需要修改一下权限:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod 755 -R /home/ibye.cn</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 疑难杂症 </tag>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Lumen配置Jwt-auth时的BUG处理]]></title>
      <url>/2017/05/07/Lumen%E9%85%8D%E7%BD%AEJwt-auth%E6%97%B6%E7%9A%84BUG%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　玩Lumen真的会遇到很多坑，jwt-auth就是其中之一，首先其对Lumen的配置教程比较少，其次可能是本人对Laravel和Lumen还不是太熟悉导致。</p>
<p>　　成功配置好Lumen+jwt-auth的时候可能还会出现问题：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Target [Illuminate\\Contracts\\Routing\\ResponseFactory] is not instantiable <span class="keyword">while</span> building [Tymon\\JWTAuth\\Middleware\\GetUserFromToken]</div></pre></td></tr></table></figure>
<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><ol>
<li><p>在<code>bootstrap/app.php</code>中添加如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$app-&gt;singleton(</div><div class="line">    Illuminate\Auth\AuthManager::class,</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> $app-&gt;make(<span class="string">'auth'</span>);</div><div class="line">    &#125;</div><div class="line">);</div><div class="line">$app-&gt;singleton(</div><div class="line">    Illuminate\Cache\CacheManager::class,</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> $app-&gt;make(<span class="string">'cache'</span>);</div><div class="line">    &#125;</div><div class="line">);</div><div class="line">$app-&gt;register(App\Providers\AppServiceProvider::class);</div></pre></td></tr></table></figure>
</li>
<li><p>修改<code>app/Providers/AppServiceProvider.php</code>，在<code>register</code>方法中添加如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">'Illuminate\Contracts\Routing\ResponseFactory'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ResponseFactory($app[<span class="string">'Illuminate\Contracts\View\Factory'</span>], $app[<span class="string">'Illuminate\Routing\Redirector'</span>]);</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>大功告成了，问题已经解决，可以愉快地开启你的Lumen+jwt之旅！</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$app-&gt;singleton(</div><div class="line">    Illuminate\Auth\AuthManager::class,</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> $app-&gt;make(<span class="string">'auth'</span>);</div><div class="line">    &#125;</div><div class="line">);</div><div class="line">$app-&gt;singleton(</div><div class="line">    Illuminate\Cache\CacheManager::class,</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> $app-&gt;make(<span class="string">'cache'</span>);</div><div class="line">    &#125;</div><div class="line">);</div><div class="line">$app-&gt;register(App\Providers\AppServiceProvider::class);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> PHP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Lumen </tag>
            
            <tag> 疑难杂症 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Lumen配置jwt详细教程]]></title>
      <url>/2017/05/06/Lumen%E9%85%8D%E7%BD%AEjwt%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>　　PHP 7.0.14 + Apache 2.4</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="1-Lumen-5-4的安装与配置"><a href="#1-Lumen-5-4的安装与配置" class="headerlink" title="1.Lumen 5.4的安装与配置"></a>1.Lumen 5.4的安装与配置</h2><h3 id="1-1-安装"><a href="#1-1-安装" class="headerlink" title="1-1 安装"></a>1-1 安装</h3><ul>
<li><p>通过Lumen安装器</p>
<p>首先，使用 Composer 下载 Lumen 安装包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer global require &quot;laravel/lumen-installer&quot;</div></pre></td></tr></table></figure>
<p>注：确保已经将<code>~/.composer/vendor/bin</code>添加到<code>PATH</code>中，只有这样系统才能找到 <code>lumen</code> 的执行文件。</p>
<p>然后使用<code>lumen new</code>命令来新建lumen项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lumen new blog_ibye_cn</div></pre></td></tr></table></figure>
</li>
<li><p>通过Composer Create-Project命令</p>
<p>只需要在终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer create-project --prefer-dist laravel/lumen blog_ibye_cn</div></pre></td></tr></table></figure>
<p>即可。</p>
</li>
</ul>
<h3 id="1-2-配置"><a href="#1-2-配置" class="headerlink" title="1-2 配置"></a>1-2 配置</h3><p>　　在项目的根目录可以看到<code>.env.example</code>文件，这是该项目的一个配置文件，将该文件复制一份，然后改名为<code>.env</code>，然后打开<code>.env</code>文件，在里面找到<code>APP_KEY</code>项，输入一个<strong><em>app_key</em></strong>，因为lumen不像laravel那样提供<strong><em>app_key</em></strong>的自动生成功能。</p>
<h2 id="2-安装与配置jwt库"><a href="#2-安装与配置jwt库" class="headerlink" title="2.安装与配置jwt库"></a>2.安装与配置jwt库</h2><h3 id="2-1-安装与配置"><a href="#2-1-安装与配置" class="headerlink" title="2-1 安装与配置"></a>2-1 安装与配置</h3><p>　　yoGa本人使用的是<strong><em>tymon/jwt-auth</em></strong>，你也可以使用其他的库。</p>
<h4 id="2-1-1-可以通过composer安装："><a href="#2-1-1-可以通过composer安装：" class="headerlink" title="2-1-1 可以通过composer安装："></a>2-1-1 可以通过composer安装：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer require tymon/jwt-auth</div></pre></td></tr></table></figure>
<h4 id="2-1-2-修改你的项目-bootstrap-app-php文件"><a href="#2-1-2-修改你的项目-bootstrap-app-php文件" class="headerlink" title="2-1-2 修改你的项目/bootstrap/app.php文件"></a>2-1-2 修改<code>你的项目/bootstrap/app.php</code>文件</h4><p>　　找到注释为<strong><em>Register Service Providers</em></strong>的地方，在下面添加如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$app-&gt;register(Tymon\JWTAuth\Providers\JWTAuthServiceProvider::class);</div></pre></td></tr></table></figure>
<p>　　这样我们就为我们的应用注册了JWTAuth的服务提供者了。程序启动的时候就会加载它。</p>
<h4 id="2-1-3-生成密钥"><a href="#2-1-3-生成密钥" class="headerlink" title="2-1-3 生成密钥"></a>2-1-3 生成密钥</h4><p>　　注意了，这里就是一个大坑，jwt-auth的文档对lumen的说明很少，很容易被坑了，官方介绍了Laravel 5的配置方法是这样的：</p>
<ol>
<li>执行<code>php artisan vendor:publish --provider=&quot;Tymon\JWTAuth\Providers\JWTAuthServiceProvider&quot;</code></li>
<li>执行<code>php artisan jwt:generate</code></li>
</ol>
<p>　　在lumen中这样是不行的，第一步已经出错了。</p>
<p>　　正确的做法应该是这样的：</p>
<ol>
<li><p>使用composer安装laravelista/lumen-vendor-publish</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer require laravelista/lumen-vendor-publish</div></pre></td></tr></table></figure>
</li>
<li><p>修改<code>app/Console/Kernel.php</code>文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kernel</span> <span class="keyword">extends</span> <span class="title">ConsoleKernel</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">protected</span> $commands = [</div><div class="line">    <span class="comment">//**************就是添加这句↓************</span></div><div class="line">        \Laravelista\LumenVendorPublish\VendorPublishCommand::class</div><div class="line">    <span class="comment">//**************就是添加这句↑************</span></div><div class="line">    ];</div><div class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">schedule</span><span class="params">(Schedule $schedule)</span></span></div><div class="line">    &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>执行<code>php artisan vendor:publish --provider=&quot;Tymon\JWTAuth\Providers\JWTAuthServiceProvider&quot;</code></p>
</li>
<li><p>执行<code>php artisan jwt:generate</code></p>
<p>　　第三步可能会出现错误(感觉lumen一定会出现，laravel就一般不会)：</p>
<p><img src="http://oivwa6p90.bkt.clouddn.com/1494075686.png" width="571" height="107"></p>
<p>　　如果出现上图的错误，如果出现错误，就继续看5、6、7</p>
</li>
<li><p>在<strong><em>app</em></strong>目录下创建一个文件<strong><em>JwtAuth.php</em></strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by PhpStorm.</div><div class="line"> * User: yoga</div><div class="line"> * Date: 17/5/6</div><div class="line"> * Time: 21:04</div><div class="line"> */</div><div class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'config_path'</span>))</div><div class="line">&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Get the configuration path.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span>  string $path</div><div class="line">     * <span class="doctag">@return</span> string</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">config_path</span><span class="params">($path = <span class="string">''</span>)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> app()-&gt;basePath() . <span class="string">'/config'</span> . ($path ? <span class="string">'/'</span> . $path : $path);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>在根目录 <strong><em>composer.json</em></strong> 文件内 <strong><em>“autoload”</em></strong> 部分添加自动加载 <strong><em>JwtAuth.php</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&quot;files&quot;: [</div><div class="line">       &quot;app/JwtAuth.php&quot;</div><div class="line">   ]</div></pre></td></tr></table></figure>
</li>
<li><p>终端执行<code>composer dump-autoload</code>，之后再执行3、4</p>
</li>
</ol>
<p><img src="http://oivwa6p90.bkt.clouddn.com/1494076233.png" width="571" height="125"></p>
<p>根目录会多了一个文件<code>config/jwt.php</code>，这样Lumen5.4+jwt就配置成功了。</p>
]]></content>
      
        <categories>
            
            <category> PHP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Lumen </tag>
            
            <tag> 教程 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Lumen5.4执行artisan时出现Memcached_Class_Not_Found]]></title>
      <url>/2017/05/06/Lumen5.4%E6%89%A7%E8%A1%8Cartisan%E6%97%B6%E5%87%BA%E7%8E%B0Memcached_Class_Not_Found/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　今天安装了Lumen 5.4，使用artisan的时候，出现了异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[Symfony\Component\Debug\Exception\FatalThrowableError]  </div><div class="line"></div><div class="line">Class &apos;Memcached&apos; not found</div></pre></td></tr></table></figure>
<h1 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h1><p>　　看了一下配置文件<code>.env</code>发现有一项是这样的：<code>CACHE_DRIVER=Memcached</code>。这个配置项说明该项目使用的缓存系统为Memcached。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>　　因为我使用Lumen还在一个学习阶段，暂时并不打算使用Memcached服务，于是乎我将该配置项改为<code>CACHE_DRIVER=file</code>，artisan就恢复正常了。</p>
]]></content>
      
        <categories>
            
            <category> PHP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Lumen </tag>
            
            <tag> 疑难杂症 </tag>
            
            <tag> PHP </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ip2long出现负数的解决方案]]></title>
      <url>/2017/05/02/ip2long%E5%87%BA%E7%8E%B0%E8%B4%9F%E6%95%B0%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　在PHP开发中，有时候会遇到一些需求，例如：获取用户的IP地址，并存到数据库当中。一般做法是将IP地址转变为整型存入数据库当中，至于如何将IP地址转成整型，有很多做法<a href="ip2long、INET_ATON">^1</a>，而我习惯用<code>ip2long</code>这个函数来处理，当然你也可以自己写一个更好的函数。</p>
<p>　　当然<code>ip2long</code>转化的IP地址并不是很完美，某些地址存在BUG，就是转换后的地址会变成一个负数(原因是溢出了)。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>　　最简单的方法是使用<code>decbin</code>将<code>ip2long</code>的返回值转成二进制，然后再通过<code>bindec</code>将结果转回十进制。(官方也推荐过另一个解决办法，在官方手册中有说明)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?PHP</span></div><div class="line"><span class="keyword">echo</span> bindec(decbin(ip2long($ip)));<span class="comment">//也可以 printf('%u', ip2long($ip));</span></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> PHP </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 疑难杂症 </tag>
            
            <tag> PHP </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hexo添加站内搜索功能]]></title>
      <url>/2017/04/22/Hexo%E6%B7%BB%E5%8A%A0%E7%AB%99%E5%86%85%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD/</url>
      <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>　　今天的主角是<code>hexo-generator-search</code>，这个插件可以帮助我们实现Hexo的站内搜索功能，而且<code>hexo-generator-search</code>安装很简单，只需要一行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-generator-search --save</div></pre></td></tr></table></figure>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>　　安装完<code>hexo-generator-search</code>之后就可以进行配置了，我们可以打开博客目录的<code>_config.yml</code>文件进行配置，</p>
<p>　　在<code>_config.yml</code>文件中添加下面的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">search:</div><div class="line">  path: search.xml</div><div class="line">  field: post</div></pre></td></tr></table></figure>
<p>　　注意：安装了Next主题，需要添加代码的是Next主题里面的<code>_config.yml</code> ，即：<code>博客根目录/themes/next/_config.yml</code>还需要将配置项<code>local_search</code>的<code>enable</code>值设置为<code>true</code>。</p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>　　该插件会在你执行<code>hexo g</code>的时候，生成搜索索引。当你上传到服务器之后就可以使用了。</p>
<p><img src="http://oivwa6p90.bkt.clouddn.com/1492865826.png" width="938" height="430"></p>
]]></content>
      
        <categories>
            
            <category> 技巧 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hexo </tag>
            
            <tag> 站内搜索 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Markdown如何做到首行缩进]]></title>
      <url>/2017/04/22/Markdown%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E9%A6%96%E8%A1%8C%E7%BC%A9%E8%BF%9B/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　最近开始用Markdown写文章，发现Markdown默认并不支持首行缩进，很多时候，我的习惯都是在每一个自然段的开头空两格。如下图所示：</p>
<p><img src="http://oivwa6p90.bkt.clouddn.com/1492863613.png" width="539" height="173"></p>
<p>　　我试过使用<code>tab</code>按键，发现文章发布之后，并没有达到预期效果。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><ol>
<li><p>修改显示markdown文章的页面的CSS样式</p>
<p>如：text-indent: 2em;</p>
</li>
<li><p>使用一定数量的<code>&amp;nbsp;</code>来达到顶格的效果</p>
</li>
<li><p>将输入法的符号设置成全角，然后再行首打两个空格</p>
</li>
</ol>
<p><img src="http://oivwa6p90.bkt.clouddn.com/1492864487.png" width="230" height="165"></p>
]]></content>
      
        <categories>
            
            <category> 技巧 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 疑难杂症 </tag>
            
            <tag> markdown </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS7之后的同步请求解决方案]]></title>
      <url>/2017/04/22/iOS7%E4%B9%8B%E5%90%8E%E7%9A%84%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>​ 　　iOS7以前，iOS的网络请求一般是通过<code>NSURLConnection sendSynchronousRequest</code>来处理，但是iOS7之后，<code>NSURLConnection</code>已经被苹果废除了，取而代之的是<code>NSURLSession</code>，而<code>NSURLSession</code>并没有提供像<code>sendSynchronousRequest</code>这种同步请求方法，那么如果实际项目中需要用到同步请求，要怎样解决呢？</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>　　下面是我的一个解决方案，就是使用GDC信号量。</p>
<h2 id="主角semaphore"><a href="#主角semaphore" class="headerlink" title="主角semaphore"></a>主角semaphore</h2><p>　　dispatch_semaphore_create　　　创建一个semaphore对象<br>　　dispatch_semaphore_signal　　　 发送一个信号<br>　　dispatch_semaphore_wait　　　　等待信号</p>
<p>　　dispatch_semaphore_create需要传入一个整型值作为参数，我们可以理解为信号的总量，dispatch_semaphore_signal是发送一个信号，自然会让信号总量加1，dispatch_semaphore_wait等待信号，当信号总量少于0的时候就会一直等待，否则就可以正常的执行，并让信号总量-1。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>1️⃣我们创建一个semaphore对象，总信号量设置为0，如：dispatch_semaphore_create(0)；<br>2️⃣在异步执行的方法结尾为第一步创建的semaphore对象发一个信号，使它的总信号量加一，如：dispatch_semaphore_signal(semaphore)；<br>3️⃣在需要阻塞的地方加上dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER)，DISPATCH_TIME_FOREVER的意思是如果semaphore的信号量一直是0的话，就一直等下去。</p>
<h2 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//step 1:创建同步信号量</div><div class="line">dispatch_semaphore_t semaphore=dispatch_semaphore_create(0);</div><div class="line">//step 2:创建请求</div><div class="line">NSMutableURLRequest *request=[NSMutableURLRequest requestWithURL:[NSURL URLWithString:urlString]];</div><div class="line">    [request setHTTPMethod:@&quot;get&quot;];</div><div class="line">    [request setValue:@&quot;iOS&quot; forHTTPHeaderField:@&quot;User-Agent&quot;];</div><div class="line">//step 3:创建urlsession实例</div><div class="line">NSURLSession *session=[NSURLSession sharedSession];</div><div class="line">//step 4:使用dataTaskWithRequest方法连接服务器</div><div class="line">    NSURLSessionDataTask *task=[session dataTaskWithRequest:request completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123;</div><div class="line">        if (error) &#123;</div><div class="line">        	//这里处理错误</div><div class="line">        &#125;</div><div class="line">        else&#123;</div><div class="line">         	//这里处理服务器返回的数据</div><div class="line">        &#125;</div><div class="line">        dispatch_semaphore_signal(semaphore);</div><div class="line">    &#125;];</div><div class="line">[task resume];</div><div class="line">dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> iOS </category>
            
        </categories>
        
        
        <tags>
            
            <tag> iOS </tag>
            
            <tag> 苹果 </tag>
            
            <tag> iPhone </tag>
            
            <tag> 同步请求 </tag>
            
            <tag> iOS7之后的同步请求解决方案 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Mac中使用brew安装php7失败的解决方案]]></title>
      <url>/2017/03/27/Mac%E4%B8%AD%E4%BD%BF%E7%94%A8brew%E5%AE%89%E8%A3%85php7%E5%A4%B1%E8%B4%A5%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<h1 id="Mac中使用brew安装php7失败的解决方案"><a href="#Mac中使用brew安装php7失败的解决方案" class="headerlink" title="Mac中使用brew安装php7失败的解决方案"></a>Mac中使用brew安装php7失败的解决方案</h1><p>​    之前写PHP一直使用mac自带的PHP5.6，看到PHP7的一些特性之后决定尝一下鲜，百度了安装教程之后，发现我使用brew按照教程安装php7还是会出现问题。</p>
<p>​    虽然是几个月前的笔记，我总结了之后，放到博客上，供自己或网友做一个参考。</p>
<h2 id="情况1：没有libphp7-so"><a href="#情况1：没有libphp7-so" class="headerlink" title="情况1：没有libphp7.so"></a>情况1：没有libphp7.so</h2><p>​    安装过程中，可能会提示缺少libphp7.so</p>
<p>​    解决方法：</p>
<p>​    xcode-select –install，之后再执行brew install php70即可，如果还不行，将xcode升级到8.1</p>
<h2 id="情况2：安装完之后apache不解释php文件"><a href="#情况2：安装完之后apache不解释php文件" class="headerlink" title="情况2：安装完之后apache不解释php文件"></a>情况2：安装完之后apache不解释php文件</h2><p>​    其实这两种情况经常同时出现，因为xcode版本的问题导致libphp7.so在安装的过程中没有安装好，这样的话配置apache的时候就会解释不了php文件了。</p>
<p>​    解决方法：打开httpd.conf(mac自带apache路径/etc/apache2/httpd.conf)，<br>添加LoadModule php7_module /usr/local/Cellar/php70/7.0.14_7/libexec/apache2/libphp7.so，<br>之后在AddType application/x-gzip .gz .tgz的下一行加上AddType application/x-httpd-php .php</p>
]]></content>
      
        <categories>
            
            <category> 技巧 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 疑难杂症 </tag>
            
            <tag> PHP </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
